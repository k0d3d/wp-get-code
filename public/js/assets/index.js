var p=Object.defineProperty;var m=(n,e,t)=>e in n?p(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>(m(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const a=window.GetCodeAppVars,h=async n=>{const e={action:"get_code_complete_purchase",nonce:a.nonce,tx_intent:n||"purchase"};try{const t=await fetch(a.ajax_url,{method:"POST",body:new URLSearchParams(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}),r=await t.text();return t.ok&&r?r:""}catch(t){return`AJAX error: ${t}`}},f=async({amount:n,currency:e,destination:t})=>{const r={action:"get_code_save_purchase",nonce:a.nonce,user_id:a.user_id,post_url:location.pathname,post_id:a.post_id,amount:n,currency:e,destination:t};try{return(await(await fetch(a.ajax_url,{method:"POST",body:new URLSearchParams(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json()).data}catch(o){return`AJAX error: ${o}`}};function y(n){n&&n.scrollIntoView({behavior:"smooth"})}function g(n){if(!isNaN(n))return n<400&&n>199}const u=window.jQuery;class w{constructor(){l(this,"transactionIsDone",!1)}validateWCCheckoutForm(){const e=this.getJQueryFormInputs();if(e)e.trigger("validate");else return!0;const t=this.getFirstInvalidInput();return t?(y(t),!1):!0}updateTransactionStatus(e){this.transactionIsDone=e}getJQueryFormInputs(){const e=u("form.woocommerce-checkout input");if(e&&e.length)return e}getFirstInvalidInput(){const e=u("form.woocommerce-checkout .woocommerce-invalid");if(e)return e[0]}handleAJAXComplete(e){u(document).ajaxComplete(function(t,r,o){var d;const s=o.url,i=((d=r.responseJSON)==null?void 0:d.result)==="failure";e(s,r.status,i)})}handleCheckoutAJAXComplete(e,t){(t||!g(e))&&this.togglePlaceOrderButton(!0)}disableCheckoutFormInputs(){this.toggleCheckoutInputsDisableState(!0)}enableCheckoutFormInputs(){this.toggleCheckoutInputsDisableState(!1)}toggleCheckoutInputsDisableState(e){const t=this.getJQueryFormInputs();if(t)for(const r of t)r.disabled=e}togglePlaceOrderButton(e){const t=this.getPlaceOrderButton();t&&t.setAttribute("aria-hidden",(!e).toString())}getPlaceOrderButton(){return document.getElementById("place_order")}preventCheckoutFormSubmit(){const e=this.getJQueryFormInputs();if(e)for(const t of e)t.addEventListener("keydown",this.preventSubmitOnEnter)}allowCheckoutFormSubmit(){const e=this.getJQueryFormInputs();if(e)for(const t of e)t.removeEventListener("keydown",this.preventSubmitOnEnter)}preventSubmitOnEnter(e){(e.key==="Enter"||e.keyCode===13)&&!this.transactionIsDone&&(e.stopImmediatePropagation(),e.preventDefault())}toggleOtherPaymentMethodsDisableState(e){const t=this.getPaymentMethodsInputs();if(t)for(const r of Array.from(t))r.disabled=e}disableOtherPaymentMethods(){this.toggleOtherPaymentMethodsDisableState(!0)}enableOtherPaymentMethods(){this.toggleOtherPaymentMethodsDisableState(!1)}triggerWCOrder(){const e=this.getWooCommercePlaceOrderButton();e&&setTimeout(()=>{e.click()},1e3)}isCheckoutAction(e){return e&&e.indexOf("wc-ajax=checkout")>=0}getWooCommercePlaceOrderButton(){return document.getElementById("place_order")}getPaymentMethodsInputs(){return document.querySelectorAll(".payment_methods input[name='payment_method'][type='radio']")}}const c=new w;function b(n){const e=document.querySelector("form.checkout");if(e){const t=document.createElement("input");t.type="hidden",t.name="tx_intent",t.value=n||"your_default_value";const r=document.createElement("input");r.type="hidden",r.name="code_checkout_nonce",r.value=window.GetCodeAppVars.nonce||"your_default_value",e.appendChild(r),e.appendChild(t)}}const C=()=>{c.enableOtherPaymentMethods(),c.enableCheckoutFormInputs(),c.triggerWCOrder()};async function I(){const{button:n}=code.elements.create("button",{currency:"usd",destination:window.GetCodeAppVars.destination,amount:parseFloat(window.GetCodeAppVars.cart_total||0)});n&&(n.on("cancel",async e=>(await h(e.intent),!0)),n.on("success",async e=>(b(e.intent),C(),!0)),n.on("invoke",async()=>{c.disableOtherPaymentMethods(),c.disableCheckoutFormInputs();const e=await f({currency:"usd",destination:window.GetCodeAppVars.destination,amount:parseFloat(window.GetCodeAppVars.cart_total||0)}),{clientSecret:t}=e;n.update({clientSecret:t})}),n.mount("#button-container"))}window.main=I;
